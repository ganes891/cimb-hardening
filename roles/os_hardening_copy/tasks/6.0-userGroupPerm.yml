- name: Set permissions and ownership on users, Groups, shadow - SEC 6.1 
  file:
    path: "{{ item.path }}"
    state: "{{ item.state }}"
    mode: "{{ item.mode }}"
    owner: "{{ item.owner }}"
    group: "{{ item.group }}"
  loop:
    - { path: '/etc/passwd', state: 'file', mode: '0644', owner: 'root', group: 'root' }
    - { path: '/etc/shadow', state: 'file', mode: '0000', owner: 'root', group: 'root' }
    - { path: '/etc/group', state: 'file', mode: '0644', owner: 'root', group: 'root' }
    - { path: '/etc/gshadow', state: 'file', mode: '0000', owner: 'root', group: 'root' }
    - { path: '/etc/ssh/sshd_config', state: 'file', mode: '0600', owner: 'root', group: 'root' }
  notify: Restart sshd

- name: Audit SUID executables - SEC-6.1.12 
  shell: df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type f perm -4000 

- name: Audit SGID executables   - SEC-6.1.13
  shell: df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type f perm -2000 

